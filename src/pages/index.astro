---
import Layout from "../layouts/Layout.astro";
import { getImage, getMedia, Resources } from "../utils/cloudinary";
import { checkLogin, getChildren } from "../utils/db";
const cookies = Astro.request.headers.get('cookie');

const authorizable = await checkLogin(cookies);
if (!authorizable.loggedIn) {
	return Astro.redirect('/welcome');
}

const children = await getChildren(authorizable);

let images: Resources[] = [];
if (children.length > 0) {
	images = await getMedia(`${import.meta.env.CLOUDINARY_FOLDER}/${children[0]}`);
}
---

<Layout title="Welcome to your favorite place to view your pictures">
	<div class="">
		<header class='text-center'>
			{authorizable.access === 'guest' ? <p>
				You are using guest mode
			</p> : null}
		</header>
		<main>
			<div class="grid grid-cols-4 gap-2 image-container">
				{images.map(image => (
				<div class="image-wrapper" set:html={getImage(image)} />
				))}
			</div>
		</main>
	</div>
</Layout>

<style>
	.image-container {}

	.image-wrapper {
		transition: transform .3s ease-in-out;
	}

	.image-wrapper:first-child {
		grid-column-start: span 2;
		grid-row-start: span 2;
	}

	.image-wrapper:hover {
		transform: scale(1.05);
	}
</style>